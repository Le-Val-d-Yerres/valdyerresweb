{% extends "include/main.html" %}
{% load filtres %}
{% load aidefilters %}
{% load eventfilters %}
{% load menufilters %}
{% load aidefilters%}
{% load hoursfilters%}
{% load tz %}
	
	{% block menu %}{% getmenu %}{% endblock %}
	
	{% block meta-description %}{{ equipement.fonction.nom }} {{ equipement.nom }} {{equipement.ville.nom }}{% endblock %}
	


{% block contenu %}	
<div class="container" style="margin-top:60px;">
	{% if cinema %}

	<div class="row-fluid">
		<div class="span12">
			<ul class="breadcrumb">
				<li>
					<a href="/">Accueil</a><span class="divider">/</span>
				</li>
				<li>
					<a href="{% url equipements.views.CarteEquipements %}">Les cinémas du Val d'Yerres</a><span class="divider">/</span>
				</li>
				<li class="active">
					{{ cinema.nom}} , {{cinema.ville.nom }}
				</li>
			</ul>
		</div>
		<div class="span7" itemscope itemtype="http://schema.org/Place">

			<h1 itemprop="name"><a href="{% url equipements.views.EquipementsDetailsHtml fonction_slug=equipement.fonction.slug equipement_slug=equipement.slug%}">{{ equipement.nom }}</a></h1>
			{% if cinema.image %}
			<img class="img-polaroid-fix"  alt="{{ equipement.nom }}" src="{{ equipement.image|resize:'670x375x1' }}">
			{% endif %}
			
			{% regroup seances by film as eventlist %}
				<table class="table  table-striped">
				{% for film in eventlist%}
				<tr>
					<td><img class="img-polaroid" src="{{film.grouper.image|resize:'240x320x1'}}"></td>
				<td><h3>{{film.grouper.titre}}</h3>Durée : {{film.grouper.duree|dureesec}}.<br/>
					<a href = "http://www.allocine.fr/film/fichefilm_gen_cfilm={{film.grouper.id_allocine_film}}.html">Fiche du film sur allocine.fr</a>.<br/>
					{% regroup film.list by cinema as cinemalist %}
					{% for cinema in cinemalist %}
					<hr/>
					Au cinéma «{{cinema.grouper.nom}}» à {{cinema.grouper.ville.nom}}:
					<ul>
						{%for seance in cinema.list%}
						<li>{{seance.date_debut|dateCustom:seance.date_fin|safe}} {%if seance.format %} ({{seance.format}}) {%endif%}{%if seance.version_vo %} {%ifnotequal seance.version_lang "Français" %} en VO ({{seance.version_lang}}){%endifnotequal%} {%endif%}</li>
						{%endfor%}
					{% endfor %}
					</ul>
					
				</td>
			
		</div>
		<div class="span4">

			<br/>

			<address>
				<div itemprop="address" itemscope itemtype="http://schema.org/PostalAddress">
					<strong>{{ cinema.nom }}</strong>
					<br/>
					<span>{{ cinema.rue }}</span>
					<br/>
					<span>{{ cinema.ville.code_postal }}</span> <span itemprop="addressLocality">{{ cinema.ville.nom }}</span>
					<br/>
					<span><abbr title="Téléphone">Tel</abbr>: {{ cinema.telephone }}</span>
					<br/>

					{% if cinema.fax %}
					<p>
						Fax : {{ equipement.fax }}
					</p>
					{% endif %}

					{% if cinema.email %}
					<p>
						Courriel : <a href="mailto:{{ equipement.email }}">{{ cinema.email }}</a>
					</p>
					{% endif %}
				</div>
			</address>
			<hr/>
			<p style="text-align: center;">
				<a href="{% url equipements.views.EquipementVCF slug=cinema.slug %}">Ajouter cet équipement à vos contacts</a>
				<br/>
				(Format Vcard)
				{{"vcard"|aide}}
			</p>
			<hr class="hidden-phone" />
			<p class="hidden-phone" style="text-align: center;">

				Ajouter cet équipement à vos contacts
				<br/>
				(Format QR Code) :
				<br/>
				<img alt="QrCode : code QR de : {{ cinema.nom }}" src="data:image/png;base64,{{ qr_code_vcard }}"/>
				{{"qr-code"|aide}}
			</p>

		</div>

	</div>
	
	
	
	<div class="row-fluid">

		<div class="span7">
			<hr/>
			<h2>Géolocalisation: <br/><small>{{equipement.rue}}, {{equipement.ville.code_postal}} {{equipement.ville.nom}}</small></h2>

			<div id="map_canvas" style="text-align:center;margin-left:auto;margin-right:auto;"></div>

		</div>
		<div class="span4" itemprop="geo" itemscope itemtype="http://schema.org/GeoCoordinates">
			<hr/>
			<p>
				Latitude : {{ equipement.latitude }}
				<br/>
				Longitude : {{ equipement.longitude }}
			</p>
			<meta itemprop="latitude" content="{{ equipement.latitude }}" />
			<meta itemprop="longitude" content="{{ equipement.longitude }}" />
			<hr class="hidden-phone" />
			<p class="hidden-phone" style="text-align: center;">
				Les coordonnées géographiques au format QR Code :
				<br/>
				<img alt="QrCode : {{ each.nom }}" src="data:image/png;base64,{{ qr_code_geo }}"/>
			</p>
		</div>

	</div>
</div>

{% else %}
<p>
	Erreur interne.
</p>
{% endif %}
</div>
{% endblock %}

	{% block jsload%}
	<script src="/static/js/jquery/jquery-1.8.1.min.js"></script>
	<script src="/static/bootstrap/js/bootstrap.js"> </script>
		<script>
			function LoadMap() 
			{
					var tabEquipement = Array();
					var myMarker = Object(); 
				    myMarker['longitude'] ={{equipement.longitude|toFloatjs}}; 
					myMarker['latitude'] ={{equipement.latitude|toFloatjs}}; 
					myMarker['description'] = '{{equipement.nom}}';
					myMarker['marker'] ='{{equipement.fonction.picto }}';
					tabEquipement.push(myMarker);
					setMarkers(tabEquipement);
					map_init();
			}
			
			$(window).resize(function () {
    			var h =$('#map_canvas').parent().width();
    			$('#map_canvas').css('height', (h*2/3));
    			$('#map_canvas').css('width', (h*2/3));
				}).resize();		
		</script>
		
		<script src="/static/js/openstreetmap/OpenLayers.js"></script>
		<script src="/static/js/openstreetmap/lib/OpenLayers/Lang/fr.js"></script>
		<script src="http://maps.google.com/maps/api/js?v=3&amp;sensor=false"></script>
		<script src="/static/js/map/osm-fonction.js"></script>
	{% endblock %}