{% extends "include/main.html" %}
{% load filtres %}
{% load aidefilters %}
{% load eventfilters %}
{% load menufilters %}
{% load aidefilters%}
{% load hoursfilters%}
{% load tz %}
	
	{% block title %} {{equipement.nom}} {% endblock %}

	
	{% block menu %}{% getmenu %}{% endblock %}
	
	{% block meta-description %}{{ equipement.fonction.nom }} {{ equipement.nom }} {{equipement.ville.nom }}{% endblock %}
	


{% block contenu %}	
<div class="container" style="margin-top:60px;">
	<div class="row-fluid">
		<div class="span12">
			<ul class="breadcrumb">
				<li>
					<a href="/">Accueil</a><span class="divider">/</span>
				</li>
				<li>
					<a href="{% url equipements.views.CarteEquipements %}">Les équipements du Val d'Yerres</a><span class="divider">/</span>
				</li>
				<li>
					<a href="{% url equipements.views.FonctionDetailsHtml fonction_slug=equipement.fonction.slug %}">{{ equipement.fonction.pluriel }}</a><span class="divider">/</span>
				</li>
				<li class="active">
					{{ equipement.nom}} , {{equipement.ville.nom }}
				</li>
			</ul>
		</div>
		<div class="span7" itemscope itemtype="http://schema.org/Place">

			<h1 itemprop="name"><a href="{% url equipements.views.EquipementsDetailsHtml fonction_slug=equipement.fonction.slug equipement_slug=equipement.slug%}">{{ equipement.nom }}</a></h1>
			{% if equipement.image %}
			<img class="img-polaroid-fix"  alt="{{ equipement.nom }}" src="{{ equipement.image|resize:'670x375x1' }}">
			{% endif %}
			{{ equipement.presentation|safe }}
		</div>
		<div class="span4">

			<br/>
			{% if equipement.fonction.logo %}
			<img src="{{equipement.fonction.logo.url}}" style="float:left;" />
			{% endif %}
			<address>
				<div itemprop="address" itemscope itemtype="http://schema.org/PostalAddress">
					<strong>{{ equipement.nom }}</strong>
					<br/>
					<span>{{ equipement.rue }}</span>
					<br/>
					<span>{{ equipement.ville.code_postal }}</span> <span itemprop="addressLocality">{{ equipement.ville.nom }}</span>
					<br/>
					<span><abbr title="Téléphone">Tel</abbr>: {{ equipement.telephone }}</span>
					<br/>

					{% if equipement.fax %}
					<p>
						Fax : {{ equipement.fax }}
					</p>
					{% endif %}

					{% if equipement.email %}
					<p>
						Courriel : <a href="mailto:{{ equipement.email }}">{{ equipement.email }}</a>
					</p>
					{% endif %}
				</div>
			</address>
			<p>
				Cet équipement est géré par le service <a href="{% url services.views.ServiceDetail service_slug=equipement.fonction.service.slug %}">{{equipement.fonction.service.nom}}</a>
			</p>
			<hr/>
			<p style="text-align: center;">
				<a class="btn btn-primary" href="{% url equipements.views.EquipementVCF slug=equipement.slug %}">Ajouter cet équipement à vos contacts <b>(Vcard)</b></a>
				<br/>
				{{"vcard"|aide}}
			</p>
			<hr class="hidden-phone" />
			<p class="hidden-phone" style="text-align: center;">

				Ajouter cet équipement à vos contacts
				<br/>
				(Format QR Code) :
				<br/>
				<img alt="QrCode : code QR de : {{ each.nom }}" src="data:image/png;base64,{{ qr_code_vcard }}"/>
				{{"qr-code"|aide}}
			</p>

		</div>

	</div>


	{% if facilites %}
	<div class="row-fluid">
		<div class="span7">
			<hr/>
			<h2>Dans cet équipement:</h2>
			<ul>
				{% for facilite in facilites.facilites.all %}
				<li style="margin-top:5px;list-style: none;"><img alt="{{ facilite.nom }}"	title="{{ facilite.nom }}" src="/media/{{ facilite.picto }}"> {{ facilite.nom }}
				</li>
				{% endfor %}
			</ul>
		</div>
	</div>

	{% endif %}
	
	{% if horaires %}
	<div class="row-fluid">
		<div class="span7">
			<hr/>
			<h2>Horaires:</h2>
			<ul>
				<li>Aujourd'hui : <b>{%nom_jour_aujourdhui%}</b>. </li>
				<ul>
				{% for horaire in horaires %}
				
					<li>{{horaire.nom}} : <b>{{horaire|horaires_aujourdhui}}</b></li>
				
				{%endfor%}
				</ul>
			</ul>
			<h3>Les 7 prochains jours : </h3>
			<table class="table table-striped" align="center">
	    		<thead>
    				<tr>
      					<th>Jour</th>
      					<th>Horaire</th>
      					    				</tr>
  				</thead>
			
				{% for horaires in horaires_plus_7 %}
					<tr>
					<td><b>{{forloop.counter|nom_jour_index}}</b> :</td>
					<td>
						<ul>
					{% for horaire in horaires %}
					<li>{{horaire.nom}} : <b>{{forloop.parentloop.counter|horaire_journee_timedelta:horaire}}</b></li>
					{% endfor %}
						</ul>
					</td>
					</tr>
				{% endfor %}
			</table>
				
				
			
			<br/>
			<p>
				<a href="{% url equipements.views.EquipementHoraires equipement_slug=equipement.slug%}">Voir tous les horaires et toutes les périodes</a>
			</p>
		</div>
	</div>
	{%endif%}
	{% if tarifs_principaux %}
	<div class="row-fluid">
		<div class="span7">
			<hr/>
			<h2>Principaux tarifs : </h2>
			<table class="table table-striped" align="center">
	    		<thead>
    				<tr>
      					<th></th>
      					<th>Résidents</th>
      					<th>Non-Résidents</th>
    				</tr>
  				</thead>
  			{% for item in tarifs_principaux %}
  				<tr>
  				<td>{{item.designation}}<br/><small>{{item.info_additionelle}}</small></td>
  				<td>{{item.prix_residents|monnaie}}</td>
  				<td>{{item.prix_non_residents|monnaie}}</td>
  				</tr>
  			{% endfor %}
  			</table>
			<br/>
			<p>
				<a href="{% url equipements.views.EquipementFonctionTarifs equipement_fonction_slug=equipement.fonction.slug %}">Voir tous les tarifs</a>
			</p>
		</div>
		
	</div>
	
	{% endif %}
	{% if evenements %}
	<div class="row-fluid">
		<div class="span7">
			<hr/>
			<h2>Les prochains évènements:</h2>
			<ul>
				{% regroup evenements by monthyeardebut as eventlist %}
				
				{% for eventmonth in eventlist %}
					<li>{{eventmonth.grouper|grouperToString}}</li>
					<ul>
					{% for each in eventmonth.list %}
					<li>
						{{ each.type.nom }} : &laquo;<a href="{% url evenements.views.EvenementDetailsHtml slug=each.cadre_evenement.slug evenement_slug=each.slug %}">{{ each.nom }}</a>&raquo; , {{ each.debut|dateCustom:each.fin }}
					</li>
				{% endfor %}
					</ul>
				{% endfor %}
			</ul>

		</div>
	</div>
	{% endif %}
	
	<div class="row-fluid">

		<div class="span7">
			<hr/>
			<h2>Géolocalisation: <br/><small>{{equipement.rue}}, {{equipement.ville.code_postal}} {{equipement.ville.nom}}</small></h2>

			<div id="map_canvas" style="text-align:center;margin-left:auto;margin-right:auto;"></div>

		</div>
		<div class="span4" itemprop="geo" itemscope itemtype="http://schema.org/GeoCoordinates">
			<hr/>
			<p>
				Latitude : {{ equipement.latitude }}
				<br/>
				Longitude : {{ equipement.longitude }}
			</p>
			<meta itemprop="latitude" content="{{ equipement.latitude }}" />
			<meta itemprop="longitude" content="{{ equipement.longitude }}" />
			<hr/>
			<p class="hidden-phone" style="text-align: center;">
				Les coordonnées géographiques au format QR Code :
				<br/>
				<img alt="QrCode : {{ each.nom }}" src="data:image/png;base64,{{ qr_code_geo }}"/>
			</p>
			<p>	
				<ul>
				<li><a href="http://www.openstreetmap.org/index.html?mlat={{equipement.latitude|toFloatjs}}&mlon={{equipement.longitude|toFloatjs}}&zoom=18"> Voir l'emplacement sur OpenstreetMap</a></li>
				<li><a href="http://maps.google.com/?q={{equipement.latitude|toFloatjs}},{{equipement.longitude|toFloatjs}}&z=19"> Voir l'emplacement sur Google Maps</a></li>
				</ul>
			</p>
		</div>

	</div>
	

</div>


</div>
{% endblock %}

	{% block jsload%}
	<script src="/static/js/jquery/jquery-1.8.1.min.js"></script>
	<script src="/static/bootstrap/js/bootstrap.js"> </script>
		<script>
			function LoadMap() 
			{
					var tabEquipement = Array();
					var myMarker = Object(); 
				    myMarker['longitude'] ={{equipement.longitude|toFloatjs}}; 
					myMarker['latitude'] ={{equipement.latitude|toFloatjs}}; 
					myMarker['description'] = '{{equipement.nom}}';
					myMarker['marker'] ='{{equipement.fonction.picto }}';
					tabEquipement.push(myMarker);
					setMarkers(tabEquipement);
					map_init();
			}
			
			$(window).resize(function () {
    			var h =$('#map_canvas').parent().width();
    			$('#map_canvas').css('height', (h*2/3));
    			$('#map_canvas').css('width', (h*2/3));
				}).resize();		
		</script>
		
		<script src="/static/js/openstreetmap/OpenLayers.js"></script>
		<script src="/static/js/openstreetmap/lib/OpenLayers/Lang/fr.js"></script>
		<script src="http://maps.google.com/maps/api/js?v=3&amp;sensor=false"></script>
		<script src="/static/js/map/osm-fonction.js"></script>
	{% endblock %}