{% extends "include/main.html" %}
{% load filtres %}
{% load aidefilters %}
{% load eventfilters %}
{% load menufilters %}
{% load aidefilters%}
{% load tz %}
	
	{% block menu %}{% getmenu %}{% endblock %}
	
	{% block meta-description %}Liste des {{ fonction.nom }} du Val d'Yerres{% endblock %}
	


{% block contenu %}	
<div class="container" style="margin-top:60px;">
	
<div class="row-fluid">
		<div class="span12">
			<ul class="breadcrumb">
				<li>
					<a href="/">Accueil</a><span class="divider">/</span>
				</li>
				<li>
					<a href="{% url equipements.views.CarteEquipements %}">Les équipements du Val d'yerres</a><span class="divider">/</span>
				</li>
				<li class="active">
					{{ fonction.pluriel }}
				</li>
			</ul>
		</div>
		<div class="span7">
		<h1><a href="{% url equipements.views.FonctionDetailsHtml fonction_slug=fonction.slug %}">{{ fonction.pluriel }}</a></h1>
		
		
	    <ul>
			{% for equipement in equipements %}
			<li><a href="{% url equipements.views.EquipementsDetailsHtml fonction_slug=fonction.slug equipement_slug=equipement.slug %}">{{ equipement.nom }}</a> à {{equipement.ville.nom}}</li>
			{% endfor %}
		</ul>
		</div>
</div>
<div class="row-fluid">
	<div class="span12">
		
		<script>
			var tabEquipement = Array();
			{% for equipement in equipements %}
				    		var my{{forloop.counter0}}Marker = Object(); 
				    		my{{forloop.counter0}}Marker['longitude'] ={{equipement.longitude|toFloatjs}} ; 
							my{{forloop.counter0}}Marker['latitude'] ={{equipement.latitude|toFloatjs}}; 	
				    	{% if equipement.image %}
							my{{forloop.counter0}}Marker['description'] = '<div style="float: left;"><img alt="{{ equipement.nom }}" src="{{ equipement.image|resize:'75x75x0' }}"/></div><div style="width:250px;"><a href="{% url equipements.views.EquipementsDetailsHtml fonction_slug=fonction.slug equipement_slug=equipement.slug %}">{{ equipement.nom }}</a><br  \>{{ equipement.rue }}<br  \>{{ equipement.ville.code_postal }}<br  \>{{ equipement.ville.nom }}</div>'; 
						{% else %}
							my{{forloop.counter0}}Marker['description'] = '<a href="{% url equipements.views.EquipementsDetailsHtml fonction_slug=fonction.slug equipement_slug=equipement.slug %}">{{ equipement.nom }}</a><br  \>{{ equipement.rue }}<br  \>{{ equipement.ville.code_postal }}<br  \>{{ equipement.ville.nom }}'; 
						{% endif %}
							my{{forloop.counter0}}Marker['marker'] ='{{fonction.picto}}';
							tabEquipement.push(my{{forloop.counter0}}Marker);			
			{% endfor %}
		</script>
		<div id="map_canvas" style="width:980px; height:800px"></div>
	</div>
</div>
</div>
	
{% endblock %}




{% block jsload%}
	<script src="/static/js/jquery/jquery-1.8.1.min.js"></script>
	<script src="/static/bootstrap/js/bootstrap.js"> </script>
		<script>
			function LoadMap() 
			{
			var tabEquipement = Array();
			{% for equipement in equipements %}
				    		var my{{forloop.counter0}}Marker = Object(); 
				    		my{{forloop.counter0}}Marker['longitude'] ={{equipement.longitude|toFloatjs}} ; 
							my{{forloop.counter0}}Marker['latitude'] ={{equipement.latitude|toFloatjs}}; 	
				    	{% if equipement.image %}
							my{{forloop.counter0}}Marker['description'] = '<div style="float: left;"><img alt="{{ equipement.nom }}" src="{{ equipement.image|resize:'75x75x0' }}"/></div><div style="width:250px;"><a href="{% url equipements.views.EquipementsDetailsHtml fonction_slug=fonction.slug equipement_slug=equipement.slug %}">{{ equipement.nom }}</a><br  \>{{ equipement.rue }}<br  \>{{ equipement.ville.code_postal }}<br  \>{{ equipement.ville.nom }}</div>'; 
						{% else %}
							my{{forloop.counter0}}Marker['description'] = '<a href="{% url equipements.views.EquipementsDetailsHtml fonction_slug=fonction.slug equipement_slug=equipement.slug %}">{{ equipement.nom }}</a><br  \>{{ equipement.rue }}<br  \>{{ equipement.ville.code_postal }}<br  \>{{ equipement.ville.nom }}'; 
						{% endif %}
							my{{forloop.counter0}}Marker['marker'] ='{{fonction.picto}}';
							tabEquipement.push(my{{forloop.counter0}}Marker);			
			{% endfor %}
					
					
					setMarkers(tabEquipement);
					map_init(13);
			}
			
			$(window).resize(function () {
    			var h =$('#map_canvas').parent().width();
    			$('#map_canvas').css('height', (h*(2/3)));
    			$('#map_canvas').css('width', (h));
				}).resize();		
		</script>
		
		<script src="/static/js/openstreetmap/OpenLayers.js"></script>
		<script src="/static/js/openstreetmap/lib/OpenLayers/Lang/fr.js"></script>
		<script src="http://maps.google.com/maps/api/js?v=3&amp;sensor=false"></script>
		<script src="/static/js/map/osm-fonction.js"></script>
	{% endblock %}	