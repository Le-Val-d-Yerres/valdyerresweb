{% extends "include/main.html" %}

	{% block meta-description %}Liste des équipements du Val d'Yerres{% endblock %}
			
{% block contenu %}

{% load filtres %}

	{% if equipements %}
	
		<h1><a href="{% url equipements.views.CarteEquipements %}">Les équipements du Val d'Yerres</a></h1>
		
		<div id="map_canvas" style="width: 1000px; height: 600px"></div>
		
		<ul>
			<script>
				var tabEquipement = Array();
			</script>
		{% for each in fonction %}
			<li><a href="{% url equipements.views.FonctionDetailsHtml fonction_slug=each.slug %}">{{ each.pluriel }}</a>
			    <ul>
				    {% for equipement in equipements %}
				    		<script>
				    		var my{{forloop.counter0}}Marker = Object(); 
				    		my{{forloop.counter0}}Marker['longitude'] ={{equipement.longitude|toFloatjs}} ; 
							my{{forloop.counter0}}Marker['latitude'] ={{equipement.latitude|toFloatjs}}; 	
				    	{% if equipement.image %}
							my{{forloop.counter0}}Marker['description'] = '<div style="float: left;"><img alt="{{ equipement.nom_lieu }}" src="{{ equipement.image|thumbnail:'100x100x0' }}"/></div><div style="height: 105px;"><a href="{% url equipements.views.EquipementsDetailsHtml fonction_slug=each.slug equipement_slug=equipement.slug %}">{{ equipement.nom_lieu }}</a><br  \>{{ equipement.rue }}<br  \>{{ equipement.ville.code_postal }}<br  \>{{ equipement.ville.nom }}</div>'; 
						{% else %}
							my{{forloop.counter0}}Marker['description'] = '<a href="{% url equipements.views.EquipementsDetailsHtml fonction_slug=each.slug equipement_slug=equipement.slug %}">{{ equipement.nom_lieu }}</a><br  \>{{ equipement.rue }}<br  \>{{ equipement.ville.code_postal }}<br  \>{{ equipement.ville.nom }}'; 
						{% endif %}
							my{{forloop.counter0}}Marker['marker'] ='{{each.picto}}';
							tabEquipement.push(my{{forloop.counter0}}Marker);
							</script>
				        <li><a href="{% url equipements.views.EquipementsDetailsHtml fonction_slug=each.slug equipement_slug=equipement.slug %}">{{ equipement.nom_lieu }}</a></li>
				    {% endfor %}
			    </ul>
		    </li>
	    {% endfor %}
	    </ul>
	    
	{% else %}
	    <p>Aucune Saison Culturelle trouvée.</p>
	{% endif %}
	
{% endblock %}
{% block jsload %}
		<script>
		function LoadMap() 
		{
			setMarkers(tabEquipement);
			map_init(13);
		}			
		</script>
		<script src="/static/js/openstreetmap/OpenLayers.js"></script>
		<script src="/static/js/openstreetmap/lib/OpenLayers/Lang/fr.js"></script>
		<script src="http://maps.google.com/maps/api/js?v=3&amp;sensor=false"></script>
		<script src="/static/js/map/osm-fonction.js"></script>
	{% endblock %}	