{% extends "include/main.html" %}

{% if saison %}
{% block meta-description %}{{ evenement.meta_description }}{% endblock %}

{% load filtres %}
{% load tz %}

{% block contenu %}

<div class="container"style="margin-top: 60px;">
	<div class="row-fluid">

			<div  itemscope itemtype="http://schema.org/Event" class="span7">

				{% if festival %}
				
					 <a itemprop="url" href="{% url evenements.views.SaisonDetailsHtml slug=saison.slug %}">{{ saison.nom }}</a> / <a href="{%url evenements.views.SaisonDetailsHtml slug=festival.slug %}">{{ festival.nom }}</a>
	
				<h1 itemprop="name"><a itemprop="url" href="{% url evenements.views.EvenementDetailsHtml slug=festival.slug evenement_slug=evenement.slug%}">{{ evenement.nom }}</a></h1>

				{% else %}
				
					<a href="{% url evenements.views.SaisonDetailsHtml slug=saison.slug %}">{{ saison.nom }}</a>
				
				<h1 itemprop="name"><a itemprop="url" href="{% url evenements.views.EvenementDetailsHtml slug=saison.slug evenement_slug=evenement.slug%}">{{ evenement.nom }}</a></h1>

				{% endif %}
				<p>
					Organisé par : {% for each in evenement.organisateur.all %}{{ each.nom }}<br/>{% endfor %}
				</p>
				{% if evenement.image %}
				<img alt="{{ evenement.nom }}" src="{{ evenement.image|resize:'670x375x1' }}">
				{% endif %}
				<meta itemprop="startDate" content="{{ evenement.debut|dateSEO }}">
				<meta itemprop="endDate" content="{{ evenement.fin|dateSEO }}">

				<p>
					Date : {{ evenement.debut|dateCustom:evenement.fin }}
				</p>
				

					<div itemprop="description">
						{{ evenement.description|safe }}
					</div>
				
				{% if evenement.url != "" %}
				<p>
					<a href="{{ evenement.url }}">Plus d'informations sur le site de l'évènement</a>
				</p>
				{% endif %}
				
			</div>
			<div class="span4">
				<br/>
				<address>
					<div itemprop="location" itemscope itemtype="http://schema.org/Place">
					<div itemprop="address" itemscope itemtype="http://schema.org/PostalAddress">
								{% if evenement.lieu.presentation %}
								<strong><a href="{% url equipements.views.EquipementsDetailsHtml fonction_slug=evenement.lieu.fonction.slug equipement_slug=evenement.lieu.slug%}">{{ evenement.lieu.nom_lieu }}</a></strong><br/>
								{% else %}
								 <strong>{{ evenement.lieu.nom_lieu }}</strong><br/>
								{% endif %}
								<span>{{ evenement.lieu.rue }}</span><br/>
								<span>{{ evenement.lieu.ville.code_postal }}</span> <span itemprop="addressLocality" >{{ evenement.lieu.ville.nom }}</span><br/>
								<span><abbr title="Téléphone">Tel</abbr>: {{ evenement.lieu.telephone }}</span><br/>

					</div>
					</div>

					</address>
				<hr/>
				
		<p style="text-align: center;">
		<a href="{% url evenements.views.EvenementDetailsICS slug=saison.slug evenement_slug=evenement.slug %}">Ajouter cet évènement à votre agenda <br/> (Format ICal)</a>
		</p>
		<hr class="hidden-phone" />
		    <p class="hidden-phone" style="text-align: center;">
		   
		    	Ajouter cet evènement à votre agenda : <br/>
					<img alt="QrCode : {{ evenement.nom }}" src="data:image/png;base64,{{ evenement_qr }}"/>
					<br/>
			</p>		
		

					
					
			</div>
	
	</div>
	<div class="row-fluid">
		<div class="span7">
			<hr/>
			<h2>Géolocalisation:</h2>
			<div id="map_canvas" style="width: 512px; height: 450px"></div>

		</div>

		<div class="span4">
			<hr/>
			<span itemprop="geo" itemscope itemtype="http://data-vocabulary.org/​Geo">
				<meta itemprop="latitude" content="{{ evenement.lieu.latitude }}" />
				<meta itemprop="longitude" content="{{ evenement.lieu.longitude }}" />
			</span>
			
			<p>
				Latitude : {{ evenement.lieu.latitude }} <br/> 
				Longitude : {{ evenement.lieu.longitude }}
			</p>
			<hr class="hidden-phone" />
		    	<p class="hidden-phone" style="text-align: center;">
			    Les coordonnées au format QR Code : <br/>
			    <img alt="QrCode : {{ each.nom_lieu }}" src="data:image/png;base64,{{ localisation_qr }}"/>
			    </p>
			<br/>
		</div>
		
	</div>
       {% if tarifs %}
		<div class="row-fluid">
			<div class="span7">
				<hr/>
				<h2>Tarification :</h2>
				<ul>
					{% for each in tarifs.prix.all %}
					<li>
						{{ each.nom }} : {{ each.prix }}
					</li>
					{% endfor %}
				</ul>
			</div>

		</div>
		{% endif %}
</div>

{% endblock %}
{% else %}
<p>
	Erreur interne.
</p>
{% endif %}

{% block jsload%}

<script src="/static/js/jquery/jquery-1.8.1.min.js"></script>
<script src="/static/bootstrap/js/bootstrap.js"></script>

<script>
	function LoadMap() {
		var tabEquipement = Array();
		var myMarker = Object();
		myMarker['longitude'] ={{evenement.lieu.longitude|toFloatjs}}  ;
		myMarker['latitude'] ={{evenement.lieu.latitude|toFloatjs}};
		myMarker['description'] = '{{evenement.lieu.nom_lieu }} - {{evenement.lieu.ville.nom }}';
		myMarker['marker'] = '{{evenement.lieu|lieuMarker }}';
		tabEquipement.push(myMarker);
		setMarkers(tabEquipement);
		map_init();

	}

	$(window).resize(function() {
		var h = $('#map_canvas').parent().width();
		$('#map_canvas').css('height', (h));
		$('#map_canvas').css('width', (h));
	}).resize();

</script>

<script src="/static/js/openstreetmap/OpenLayers.js"></script>
<script src="/static/js/openstreetmap/lib/OpenLayers/Lang/fr.js"></script>
<script src="http://maps.google.com/maps/api/js?v=3&amp;sensor=false"></script>
<script src="/static/js/map/osm-fonction.js"></script>
{% endblock%}
